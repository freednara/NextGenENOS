<template>
    <lightning-card title="My Shopping Cart" icon-name="standard:cart">
        <div class="slds-var-p-around_medium">
            
            <!-- Loading State -->
            <template if:true={isLoading}>
                <div class="slds-var-p-around_medium slds-text-align_center">
                    <lightning-spinner alternative-text="Processing..." size="medium"></lightning-spinner>
                    <p class="slds-var-p-top_medium">Processing your request...</p>
                </div>
            </template>

            <!-- Error State -->
            <template if:true={hasError}>
                <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="alert">
                    <span class="slds-assistive-text">error</span>
                    <lightning-icon icon-name="utility:error" alternative-text="Error" size="small"></lightning-icon>
                    <h2>Unable to Load Cart</h2>
                    <p>{errorMessage}</p>
                    <div class="slds-var-p-top_small">
                        <lightning-button 
                            variant="neutral" 
                            label="Try Again" 
                            onclick={refreshCart}
                            class="slds-var-m-right_small">
                        </lightning-button>
                    </div>
                </div>
            </template>

            <!-- Cart Content -->
            <template if:false={hasError}>
                <template if:true={hasCartItems}>
                    <!-- Cart Items Table -->
                    <div class="cart-table-container">
                        <lightning-datatable
                            key-field="Id"
                            data={cartItems}
                            columns={columns}
                            draft-values={draftValues}
                            onrowaction={handleRowAction}
                            onsave={handleSave}
                            hide-checkbox-column
                            show-row-number-column="false"
                            sorted-by="CreatedDate"
                            sorted-direction="asc">
                        </lightning-datatable>
                    </div>

                    <!-- Cart Summary and Actions -->
                    <div class="slds-grid slds-wrap slds-var-p-top_large">
                        <!-- Cart Summary -->
                        <div class="slds-col slds-size_1-of-1 slds-medium-size_2-of-3">
                            <div class="cart-summary">
                                <div class="slds-grid slds-wrap">
                                    <div class="slds-col slds-size_1-of-2 slds-var-p-bottom_small">
                                        <span class="slds-text-title_caps slds-text-color_weak">Total Items:</span>
                                        <span class="slds-var-p-left_x-small slds-text-body_regular slds-text-heading_small">
                                            {totalItems}
                                        </span>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2 slds-var-p-bottom_small">
                                        <span class="slds-text-title_caps slds-text-color_weak">Items in Cart:</span>
                                        <span class="slds-var-p-left_x-small slds-text-body_regular slds-text-heading_small">
                                            {cartItems.length}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cart Actions -->
                        <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
                            <div class="cart-actions slds-text-align_right">
                                <!-- Subtotal Display -->
                                <div class="slds-var-p-bottom_medium">
                                    <p class="slds-text-heading_medium slds-text-color_success">
                                        Subtotal: 
                                        <lightning-formatted-number
                                            value={subtotal}
                                            format-style="currency"
                                            currency-code="USD"
                                            class="slds-var-p-left_small">
                                        </lightning-formatted-number>
                                    </p>
                                </div>

                                <!-- Action Buttons -->
                                <div class="action-buttons">
                                    <lightning-button 
                                        label="Continue Shopping" 
                                        variant="neutral" 
                                        onclick={handleContinueShopping}
                                        class="slds-var-m-right_small slds-var-m-bottom_small">
                                    </lightning-button>
                                    
                                    <lightning-button 
                                        label="Proceed to Checkout" 
                                        variant="brand" 
                                        onclick={handleProceedToCheckout}
                                        class="slds-var-m-bottom_small">
                                    </lightning-button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cart Instructions -->
                    <div class="slds-var-p-top_medium">
                        <div class="slds-box slds-theme_shade slds-var-p-around_small">
                            <h3 class="slds-text-heading_small slds-var-m-bottom_small">Cart Management Tips:</h3>
                            <ul class="slds-list_dotted">
                                <li>Click on quantity values to edit them directly in the table</li>
                                <li>Use the delete button to remove items you no longer want</li>
                                <li>All changes are automatically saved when you click outside the quantity field</li>
                                <li>Your cart is automatically updated across all components</li>
                            </ul>
                        </div>
                    </div>

                </template>

                <!-- Empty Cart State -->
                <template if:false={hasCartItems}>
                    <div class="slds-var-p-around_large slds-text-align_center empty-cart">
                        <lightning-icon 
                            icon-name="standard:cart" 
                            size="x-large" 
                            alternative-text="Empty Cart"
                            class="slds-var-m-bottom_medium">
                        </lightning-icon>
                        
                        <h2 class="slds-text-heading_medium slds-var-m-bottom_small">Your cart is empty</h2>
                        
                        <p class="slds-text-body_regular slds-var-m-bottom_large slds-text-color_weak">
                            Looks like you haven't added any products to your cart yet.
                        </p>
                        
                        <lightning-button 
                            label="Start Shopping" 
                            variant="brand" 
                            onclick={handleContinueShopping}
                            icon-name="utility:add">
                        </lightning-button>
                    </div>
                </template>
            </template>

        </div>
    </lightning-card>
</template>
