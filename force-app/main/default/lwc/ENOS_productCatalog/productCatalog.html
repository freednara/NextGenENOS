<template>
  <lightning-card title="Product Catalog" icon-name="standard:product">
    <!-- Search and Filters -->
    <div class="slds-p-around_medium">
      <div class="slds-grid slds-wrap slds-gutters">
        <!-- Search Bar -->
        <div
          class="slds-col slds-size_1-of-2 slds-medium-size_1-of-3 slds-large-size_1-of-4"
        >
          <lightning-input
            type="search"
            label="Search Products"
            placeholder="Search by name or description..."
            value={searchTerm}
            onchange={handleSearchChange}
          >
          </lightning-input>
        </div>

        <!-- Category Filter -->
        <div
          class="slds-col slds-size_1-of-2 slds-medium-size_1-of-3 slds-large-size_1-of-4"
        >
          <lightning-combobox
            name="category"
            label="Category"
            value={selectedCategory}
            placeholder="All Categories"
            options={categoryOptions}
            onchange={handleCategoryChange}
          >
          </lightning-combobox>
        </div>

        <!-- Top Sellers Filter -->
        <div
          class="slds-col slds-size_1-of-2 slds-medium-size_1-of-3 slds-large-size_1-of-4"
        >
          <lightning-input
            type="checkbox"
            label="Top Sellers Only"
            checked={topSellersOnly}
            onchange={handleTopSellersChange}
          >
          </lightning-input>
        </div>
      </div>
    </div>

    <!-- Loading Spinner -->
    <template if:true={loading}>
      <div class="slds-p-around_medium slds-text-align_center">
        <lightning-spinner
          alternative-text="Loading products..."
          size="medium"
        ></lightning-spinner>
      </div>
    </template>

    <!-- Product Grid -->
    <template if:false={loading}>
      <div class="slds-p-around_medium">
        <!-- Results Count and Pagination Info -->
        <div class="slds-grid slds-grid_align-spread slds-m-bottom_medium">
          <div class="slds-text-body_small slds-text-color_weak">
            {pageInfo}
          </div>

          <!-- Pagination Controls -->
          <template if:true={showPagination}>
            <div class="slds-button-group">
              <lightning-button
                variant="neutral"
                label="Previous"
                disabled={hasPreviousPage}
                onclick={handlePreviousPage}
              >
              </lightning-button>
              <lightning-button
                variant="neutral"
                label="Next"
                disabled={hasNextPage}
                onclick={handleNextPage}
              >
              </lightning-button>
            </div>
          </template>
        </div>

        <!-- No Results Message -->
        <template if:true={showNoResults}>
          <div class="slds-text-align_center slds-p-vertical_x-large">
            <lightning-icon
              icon-name="utility:search"
              size="large"
              class="slds-m-bottom_small"
            ></lightning-icon>
            <p class="slds-text-heading_medium">No products found</p>
            <p class="slds-text-body_regular slds-text-color_weak">
              Try adjusting your search criteria
            </p>
          </div>
        </template>

        <!-- Product Grid -->
        <template if:true={products.length}>
          <div class="slds-grid slds-wrap slds-gutters">
            <template for:each={displayedProducts} for:item="product">
              <div
                key={product.Id}
                class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3 slds-m-bottom_medium"
              >
                <div class="product-card slds-card slds-card_boundary">
                  <!-- Product Image -->
                  <div class="product-image-container slds-p-around_small">
                    <template if:true={product.Image_URL__c}>
                      <img
                        src={product.Image_URL__c}
                        alt={product.Name}
                        class="product-image"
                      />
                    </template>
                    <template if:false={product.Image_URL__c}>
                      <div
                        class="product-image-placeholder slds-text-align_center"
                      >
                        <lightning-icon
                          icon-name="standard:product"
                          size="large"
                        ></lightning-icon>
                      </div>
                    </template>
                  </div>

                  <!-- Product Info -->
                  <div class="slds-p-around_small">
                    <h3 class="slds-text-heading_small slds-m-bottom_x-small">
                      <a
                        href="#"
                        onclick={handleProductClick}
                        data-product-id={product.Id}
                        class="product-link"
                      >
                        {product.Name}
                      </a>
                    </h3>

                    <p
                      class="slds-text-body_small slds-text-color_weak slds-m-bottom_small"
                    >
                      {product.Description}
                    </p>

                    <div
                      class="slds-grid slds-grid_align-spread slds-m-bottom_small"
                    >
                      <span class="slds-text-body_small">
                        SKU: {product.ProductCode}
                      </span>
                      <span class="slds-text-body_small">
                        Stock: {product.Stock_Quantity__c}
                      </span>
                    </div>

                    <!-- Category Badge -->
                    <template if:true={product.Category__c}>
                      <div class="slds-m-bottom_small">
                        <span class="slds-badge slds-theme_alt-inverse"
                          >{product.Category__c}</span
                        >
                      </div>
                    </template>

                    <!-- Top Seller Badge -->
                    <template if:true={product.Is_Top_Seller__c}>
                      <div class="slds-m-bottom_small">
                        <span class="slds-badge slds-theme_success"
                          >Top Seller</span
                        >
                      </div>
                    </template>

                    <!-- Action Buttons -->
                    <div class="slds-grid slds-grid_align-spread">
                      <template if:true={product.Stock_Quantity__c}>
                        <lightning-button
                          variant="brand"
                          label="Add to Cart"
                          size="small"
                          onclick={handleAddToCart}
                          data-product-id={product.Id}
                          data-quantity="1"
                        >
                        </lightning-button>
                      </template>
                      <template if:false={product.Stock_Quantity__c}>
                        <lightning-button
                          variant="neutral"
                          label="Out of Stock"
                          size="small"
                          disabled="true"
                        >
                        </lightning-button>
                        <lightning-button
                          variant="outline-brand"
                          label="Notify Me"
                          size="small"
                          onclick={handleBackInStock}
                          data-product-id={product.Id}
                        >
                        </lightning-button>
                      </template>
                    </div>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </template>
      </div>
    </template>
  </lightning-card>
</template>
